{% extends 'base.html' %}
{% block title %}üõí Grocery Items{% endblock %}

{% block content %}
<div class="view-items-container">
  <!-- üîç Search + Filter -->
  <div class="search-filter-section">
    <div class="top-bar">
      <h2>üõí Smart Grocery</h2>
      <form method="GET" action="{{ url_for('view_items') }}" class="search-form">
        <input id="searchInput" type="text" name="search" placeholder="Search groceries..." value="{{ request.args.get('search', '') }}">
        <button type="submit">üîç</button>
        <button type="button" onclick="startVoiceSearch()">üé§</button>
        <select name="category">
          <option value="all" {% if request.args.get('category') == 'all' %}selected{% endif %}>üîÑ Show All</option>
          <option value="fruits" {% if request.args.get('category') == 'fruits' %}selected{% endif %}>üçé Fruits</option>
          <option value="vegetables" {% if request.args.get('category') == 'vegetables' %}selected{% endif %}>ü•¶ Vegetables</option>
          <option value="snacks" {% if request.args.get('category') == 'snacks' %}selected{% endif %}>üç™ Snacks</option>
          <option value="beverages" {% if request.args.get('category') == 'beverages' %}selected{% endif %}>üßÉ Beverages</option>
        </select>
      </form>
    </div>
  </div>

  <!-- üõç Items Grid -->
  <h3 class="section-title">üõç Available Grocery Items</h3>
  <div class="product-grid">
    {% for item in items %}
    <div class="product-card">
      <img src="{{ url_for('static', filename='uploads/' ~ item.image) }}" alt="{{ item.name }}">
      <div class="product-info">
        <h4>{{ item.name }}</h4>
        <p class="price">‚Çπ{{ item.price }}</p>
        <p class="desc">{{ item.description or 'No description available.' }}</p>
        <p class="offers">üî• Offers: {{ item.offer or 'None' }}</p>
        <p class="stock">Stock: {{ item.stock or item.quantity }}</p>
      </div>
      <div class="product-actions">
        <form action="{{ url_for('add_to_cart', item_id=item._id) }}" method="POST">
          <input type="hidden" name="quantity" value="1">
          <button type="submit" class="add-cart-btn">üõí Add to Cart</button>
        </form>
        <form action="{{ url_for('buy_now', item_id=item._id) }}" method="POST">
          <button type="submit" class="buy-now-btn">‚ö° Buy Now</button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<style>
.view-items-container {
  background-color: #1e1e1e;
  color: #f0f0f0;
  padding: 20px;
  border-radius: 10px;
}

.search-filter-section {
  background-color: #2b2b2b;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
}

.top-bar {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}

.top-bar h2 {
  margin: 0;
  color: #4dd0e1;
  font-size: 22px;
}

.search-form {
  display: flex;
  gap: 10px;
  flex-grow: 1;
  max-width: 600px;
  margin-top: 10px;
}

.search-form input,
.search-form select {
  padding: 10px;
  border-radius: 6px;
  border: none;
  background-color: #f9f9f9;
  color: #000;
  flex: 1;
}

.search-form button {
  padding: 10px 16px;
  background-color: #4dd0e1;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}

.section-title {
  margin: 20px 0;
  font-size: 22px;
  color: #ffffff;
}

.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
}

.product-card {
  background-color: #2c2c2c;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.product-card:hover {
  transform: scale(1.02);
  box-shadow: 0 4px 16px rgba(0,0,0,0.5);
}

.product-card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}

.product-info {
  padding: 12px 16px;
}

.product-info h4 {
  margin: 0 0 6px;
  font-size: 18px;
  color: #ffffff;
}

.product-info .price {
  color: #00e676;
  font-weight: bold;
  margin-bottom: 4px;
}

.product-info .desc,
.product-info .offers,
.product-info .stock {
  font-size: 13px;
  margin: 2px 0;
  color: #ccc;
}

.product-actions {
  display: flex;
  gap: 10px;
  padding: 12px;
  border-top: 1px solid #444;
  justify-content: center;
  background-color: #1a1a1a;
}

.product-actions button {
  flex: 1 1 48%;
  min-width: 120px;
  padding: 10px;
  font-size: 15px;
  border-radius: 8px;
  font-weight: bold;
  border: none;
  cursor: pointer;
  transition: transform 0.2s, background-color 0.2s ease;
}

.product-actions .add-cart-btn {
  background-color: #ffc107;
  color: #000;
}

.product-actions .buy-now-btn {
  background-color: #28a745;
  color: white;
}

.product-actions .add-cart-btn:hover {
  background-color: #e0a800;
  transform: scale(1.03);
}

.product-actions .buy-now-btn:hover {
  background-color: #218838;
  transform: scale(1.03);
}

@media (max-width: 500px) {
  .search-form {
    flex-direction: column;
  }

  .product-actions button {
    flex: 1 1 100%;
    margin-bottom: 6px;
  }
}
</style>

<script>
function startVoiceSearch() {
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-IN';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.start();

    recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById('searchInput').value = transcript;
        document.querySelector('.search-form').submit();
    };

    recognition.onerror = function(event) {
        alert('üé§ Voice recognition error: ' + event.error);
    };
}
</script>
{% endblock %}
